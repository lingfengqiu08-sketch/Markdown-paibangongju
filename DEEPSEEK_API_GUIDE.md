# 🤖 DeepSeek API 集成指南

## 功能介绍

现在注意力追踪系统已集成 **DeepSeek AI 分析功能**，可以：

✅ 自动分析每日时间使用模式
✅ 发现专注度问题
✅ 给出个性化改进建议
✅ 生成明日规划建议
✅ 提供实时优化提示

---

## 快速开始

### 1️⃣ 获取 DeepSeek API Key

**步骤：**

1. 访问 [DeepSeek 开放平台](https://platform.deepseek.com)
2. 点击右上角「注册/登录」
3. 完成注册（支持微信、手机号）
4. 进入控制台 → 「API Keys」
5. 点击「创建 API Key」
6. **重要**：复制并保存 API Key（只显示一次！）

**价格说明：**

DeepSeek 是目前最便宜的大模型 API 之一：

- **输入**: ¥1 / 百万 tokens
- **输出**: ¥2 / 百万 tokens
- **每日分析成本**: 约 ¥0.001 元/次（1厘钱！）
- **首次注册**: 赠送 ¥10 体验金

**实际花费计算：**
- 每天生成1次分析：¥0.001 × 30 = ¥0.03/月
- 每天生成3次分析：¥0.003 × 30 = ¥0.09/月
- ¥10 体验金可以用 **1万次** 分析！

---

### 2️⃣ 配置 API Key

#### 方法1：环境变量（推荐）

**macOS / Linux:**
```bash
# 临时设置（当前终端有效）
export DEEPSEEK_API_KEY="sk-xxxxxxxxxxxxxxxx"

# 永久设置（添加到 ~/.zshrc 或 ~/.bashrc）
echo 'export DEEPSEEK_API_KEY="sk-xxxxxxxxxxxxxxxx"' >> ~/.zshrc
source ~/.zshrc
```

**Windows (PowerShell):**
```powershell
# 临时设置
$env:DEEPSEEK_API_KEY="sk-xxxxxxxxxxxxxxxx"

# 永久设置
[Environment]::SetEnvironmentVariable("DEEPSEEK_API_KEY", "sk-xxxxxxxxxxxxxxxx", "User")
```

#### 方法2：启动时设置

```bash
DEEPSEEK_API_KEY="sk-xxxxxxxxxxxxxxxx" streamlit run app.py
```

#### 方法3：使用 .env 文件（未来支持）

创建 `.env` 文件：
```
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxx
```

---

### 3️⃣ 启动应用

```bash
# 激活虚拟环境
source venv/bin/activate

# 启动应用
streamlit run app.py
```

应用地址: http://localhost:8501

---

## 使用指南

### AI 分析功能位置

打开应用 → 切换到第三个标签页 **「📊 统计报告」**

---

### 功能1: 💡 今日提示

**触发方式**: 自动显示

每次打开应用，会根据今日记录自动生成 3 条快速提示：

- ⚠️ 低专注时段较多 → 建议减少干扰
- 🎉 高专注比例很棒 → 鼓励保持
- 📝 增加记录频率 → 数据更准确
- 🌅 找出黄金时段 → 优化任务安排

**特点**:
- 无需 API 调用，完全免费
- 基于规则引擎，实时响应
- 简单直接，快速获取建议

---

### 功能2: 📊 今日深度分析

**触发方式**: 手动点击「🚀 生成 AI 分析」按钮

**分析内容**:

1. **整体评价** - AI 用 2-3 句话总结你今天的时间使用
2. **亮点发现** - 夸夸你做得好的地方（正向激励）
3. **改进建议** - 2-3 条具体可执行的建议
4. **明日规划** - 基于今天数据，给出明天的时间安排建议

**示例输出**:

```markdown
### 📊 今日分析报告

#### 1. 整体评价
今天你共记录了 6.5 小时，其中工作占比 55%，学习占比 25%。
整体时间利用率不错，但下午 3 点后专注度明显下降。

#### 2. 亮点发现 🌟
- ✅ 上午 9-11 点保持了 2 小时高专注工作，效率很高
- ✅ 安排了 1.5 小时学习时间，坚持自我提升值得点赞

#### 3. 改进建议 💡
1. 下午茶时间（15:00）后专注度下降，建议喝杯咖啡或出去走走
2. 刷手机时间占了 1.5 小时，可以尝试使用番茄工作法控制
3. 晚上 8 点后可以安排轻松任务（阅读、整理笔记），别安排需要高专注的工作

#### 4. 明日规划 📅
- 把最重要的任务安排在 9-11 点（你的黄金时段）
- 下午 3 点设置 15 分钟户外休息
- 睡前 30 分钟远离电子设备，改善睡眠质量
```

---

### 功能3: 周报分析（未来版本）

**计划功能**:
- 本周总结（7天数据汇总）
- 最佳表现日识别
- 周对比（本周 vs 上周）
- 下周目标制定

---

## 常见问题

### Q1: 没有配置 API Key 会怎样？

**A:** 应用仍然可以正常使用，但 AI 分析功能会显示配置提示：

```
⚠️ 未配置 API Key

请设置环境变量：
export DEEPSEEK_API_KEY="your-api-key-here"

获取 API Key：https://platform.deepseek.com
```

**💡 今日提示** 功能不受影响，仍然可以使用！

---

### Q2: API Key 配置错误怎么办？

**A:** 会显示具体错误信息：

```
❌ AI 分析失败

错误信息: Invalid API Key

可能的原因：
1. API Key 无效或已过期
2. 网络连接问题
3. API 配额不足
```

**解决方法**:
1. 检查 API Key 是否正确复制（注意首尾空格）
2. 访问 DeepSeek 平台检查账户状态
3. 确认账户余额充足

---

### Q3: 为什么选择 DeepSeek 而不是 OpenAI？

**A:**

| 对比项 | DeepSeek | OpenAI GPT-4 |
|--------|----------|--------------|
| 价格 | ¥1/百万输入 tokens | ¥210/百万输入 tokens |
| 中文能力 | 原生中文模型，理解更好 | 英文为主 |
| 访问限制 | 国内直接访问 | 需要特殊网络 |
| 每日分析成本 | ¥0.001/次 | ¥0.21/次 |

DeepSeek 是 **性价比之王**，特别适合个人项目！

---

### Q4: 分析结果会保存吗？

**A:** 当前版本暂时不保存，关闭浏览器后需要重新生成。

**未来版本**会支持：
- 分析历史记录
- 导出为 PDF/Markdown
- 周报/月报归档

---

### Q5: 可以自定义分析风格吗？

**A:** 当前版本使用固定的提示词模板。

**未来计划**支持：
- 正式风格 / 轻松风格
- 简洁版 / 详细版
- 自定义分析维度

你可以直接修改 `ai_analysis.py` 文件中的 `prompt` 变量来自定义！

---

## 技术细节

### 文件说明

**`ai_analysis.py`** - AI 分析模块

- `get_daily_analysis()` - 生成每日分析报告
- `get_weekly_analysis()` - 生成每周分析（未使用）
- `get_productivity_tips()` - 生成快速提示（无需 API）

**核心代码**:

```python
from openai import OpenAI

client = OpenAI(
    api_key=DEEPSEEK_API_KEY,
    base_url="https://api.deepseek.com"
)

response = client.chat.completions.create(
    model="deepseek-chat",
    messages=[
        {"role": "system", "content": "你是时间管理顾问..."},
        {"role": "user", "content": prompt}
    ],
    temperature=0.7,
    max_tokens=1000
)
```

### API 调用流程

1. 用户点击「生成 AI 分析」
2. 从数据库读取今日所有记录
3. 构建数据摘要（任务分布、专注度统计）
4. 生成提示词（包含数据 + 分析要求）
5. 调用 DeepSeek API
6. 解析返回的 Markdown 格式报告
7. 显示在界面上

### Token 消耗估算

**每日分析**:
- 输入: 约 500-800 tokens（数据 + 提示词）
- 输出: 约 300-500 tokens（分析报告）
- 总计: 约 800-1300 tokens
- 成本: ¥0.0008 - ¥0.0013

**周报分析**:
- 输入: 约 1500-2000 tokens
- 输出: 约 500-800 tokens
- 总计: 约 2000-2800 tokens
- 成本: ¥0.002 - ¥0.0028

---

## 进阶使用

### 自定义提示词

编辑 `ai_analysis.py` 第 65-82 行，修改分析要求：

```python
prompt += """
请从以下角度给出分析和建议（使用 Markdown 格式）：

1. **整体评价** (2-3句话概括今天的时间使用情况)
2. **亮点发现** (做得好的地方，1-2个亮点)
3. **改进建议** (具体可执行的建议，2-3条)
4. **明日规划** (基于今天的数据，给出明天的时间安排建议)

要求：
- 语气友好、鼓励为主
- 建议具体可行，不要空泛
- 字数控制在300字以内
- 使用 emoji 让内容更生动
"""
```

**你可以自定义**：
- 增加分析维度（如：健康建议、情绪分析）
- 调整语气风格（正式 / 轻松 / 犀利）
- 修改字数限制
- 添加特定领域建议（学习 / 工作 / 创业）

### 调整模型参数

修改 `temperature` 控制创造性：

```python
response = client.chat.completions.create(
    model="deepseek-chat",
    temperature=0.3,  # 0.0-1.0，越低越稳定，越高越创新
    max_tokens=1000
)
```

- `temperature=0.3` - 稳定、一致的分析
- `temperature=0.7` - 平衡（默认）
- `temperature=0.9` - 创造性强，内容多样

---

## 数据隐私

### DeepSeek 会存储我的数据吗？

根据 [DeepSeek 隐私政策](https://platform.deepseek.com/privacy)：

✅ **API 调用数据不会用于模型训练**
✅ **不会与第三方共享**
✅ **仅用于提供服务**

### 本地数据安全

- 所有时间记录存储在本地 `attention.db` 文件
- 只有生成分析时才会发送数据到 API
- 发送的数据：任务名称、时长、专注度（不含隐私信息）
- 不会发送备注内容中的敏感信息

### 建议

如果你担心隐私问题：
- 不要在备注中填写敏感信息
- 或者修改 `ai_analysis.py` 过滤掉备注内容

---

## 黑客松演示技巧

### 演示脚本（30秒）

1. **展示问题**
   "我记录了今天的时间，看起来很忙，但不知道问题在哪"

2. **点击按钮**
   点击「🚀 生成 AI 分析」

3. **展示结果**
   "AI 告诉我：上午效率高，但下午 3 点后专注度下降，建议喝咖啡休息"

4. **强调价值**
   "每次分析只花 1 厘钱，但能帮我每天节省 1 小时低效时间！"

### 亮点话术

- 💰 **超低成本**: "每月花 3 分钱，获得专业时间管理建议"
- 🚀 **即时反馈**: "3 秒生成报告，不用等到周末总结"
- 🎯 **个性化**: "基于你的真实数据，不是通用建议"
- 🇨🇳 **中文友好**: "DeepSeek 中文能力强，理解更准确"

---

## 下一步开发

### Phase 2 功能
- [ ] 周报/月报生成
- [ ] 分析历史记录
- [ ] 导出为 PDF
- [ ] 多维度分析（健康、情绪）

### Phase 3 功能
- [ ] 语音播报分析结果
- [ ] 自定义分析模板
- [ ] 团队版（对比分析）
- [ ] 习惯养成追踪

---

## 故障排除

### 问题1: API 调用超时

**现象**: 等待很久，最后显示超时错误

**原因**: 网络问题或 API 负载高

**解决**:
```python
# 在 ai_analysis.py 中增加超时设置
client = OpenAI(
    api_key=DEEPSEEK_API_KEY,
    base_url=DEEPSEEK_BASE_URL,
    timeout=30.0  # 30秒超时
)
```

### 问题2: 中文乱码

**现象**: 分析结果出现乱码

**解决**: 确保代码文件使用 UTF-8 编码
```bash
file -I ai_analysis.py  # 检查编码
```

### 问题3: API 余额不足

**现象**: 错误信息包含 "insufficient balance"

**解决**:
1. 访问 https://platform.deepseek.com
2. 进入「余额管理」
3. 充值（最低 ¥10）

---

## 联系支持

**DeepSeek 官方**:
- 官网: https://platform.deepseek.com
- 文档: https://platform.deepseek.com/docs
- 工单: 控制台 → 帮助与支持

**项目相关**:
- 如有问题，欢迎提 Issue 或 PR

---

**祝你用 AI 高效管理时间！🎉**
